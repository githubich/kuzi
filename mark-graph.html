<!DOCTYPE html>
    <head>
		<script src="/lib/qTools.min.js"></script>
        <link async rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@2/dist/Chart.min.css">
        <script async src="https://cdn.jsdelivr.net/npm/chart.js@2/dist/Chart.min.js"></script>
        <script>
            random = (min,max) => {return Math.floor(Math.random()*(max-min+1)+min)}
            resize = () => {
                $('#graph').setAttribute('height', $().offsetHeight)
                $('#graph').setAttribute('width', $().offsetWidth)
            }
            refresh = (forcedCount) => {
                if (mouseOver == false) {
                    if (forcedCount) c = forcedCount
                    if (c >= resData.length) c = 0
                    let subject = resData[c]
                    let data = []
                    let labels = []
                    let i = 0
                    subject.marks.forEach(mark => {
                        data.push(mark.mark)
                        labels.push(mark.name)
                    })
                    markGraph.data.datasets[0].data = data
                    markGraph.data.datasets[0].label = subject.subjectName
                    markGraph.data.labels = labels
                    markGraph.options.title.text = subject.subjectName
                    markGraph.update()
                    c++
                    resize()
                    setTimeout(refresh, 5000)
                } else {
                    setTimeout(refresh, 0)
                }
            }
            window.addEventListener('load', resize)
            window.addEventListener('resize', resize)
            window.addEventListener('load', () => {
                fetch('/students/marks/graph', { method: "POST" })
                    .then(res => res.json()
                        .then(res => {
                            resData = res
                            c = 0
                            let subject = resData[c]
                            let ctx = $('#graph').getContext('2d');
                            markGraph = new Chart(ctx, {
                                type: 'line',
                                data: {
                                    labels: [],
                                    datasets: [{
                                        data: [],
                                        backgroundColor: '#0070c07a',
                                        borderWidth: 1
                                    }]
                                },
                                options: {
                                    animation: {
                                        duration: 600
                                    },
                                    maintainAspectRatio: false,
                                    title: {
                                        display: true,
                                    },
                                    tooltips: {
                                        displayColors: false
                                    },
                                    legend: {
                                        display: false
                                    },
                                    scales: {
                                        xAxes: [{
                                            ticks: {
                                                display: false
                                            },
                                            gridLines: {
                                                color: "#0000"
                                            }
                                        }],
                                        yAxes: [{
                                            ticks: {
                                                beginAtZero: true,
                                                max: 100
                                            },
                                            steps: 10,
                                            gridLines: {
                                                color: "#0000"
                                            }
                                        }]
                                    }
                                }
                                
                            })
                            mouseOver = false
                            refresh(0)
                        }))
            })
        </script>
        <style>
            html, head, body, div, canvas {
                margin: 0; padding: 0;
                overflow: hidden;
                height: 100% !important;
            }
        </style>
    </head>
    <body>
        <div>
            <canvas onmouseover="mouseOver = true" onmouseout="mouseOver = false" id="graph"></canvas>
        </div>
    </body>
</html>